# ๐ Workflows & Use Cases Specification (WUCS)
## Project: Nasaq (ูุณู)
**Version:** 1.2 (Total Control & Media Update)
**Document ID:** 03_WUCS
**Date:** Jan 2026

---

### 1. ๐ฏ ุงูุบุฑุถ ูู ุงููุซููุฉ (Document Purpose)
ุชุตู ูุฐู ุงููุซููุฉ ุงูุชูุงุนูุงุช ุงูุฏูููุฉ ุจูู ุงููุณุชุฎุฏู ูุงููุธุงู. ุชูุฏู ุฅูู ุชูุถูุญ "ููููุฉ ุงูุงุณุชุฎุฏุงู" ูููุทูุฑูู ูุงููุตููููุ ูุน ุงูุชุฑููุฒ ุนูู ุงูุณููุงุฑูููุงุช ุงูุฌุฏูุฏุฉ: ุงูุชุญูู ูู ุงุชุฌุงู ุงููุตุ ูุฅุฏุงุฑุฉ ุงูุตูุฑ ุงููุญููุฉุ ูุญูุงูุฉ ุงูุจูุงูุงุช.

---

### 2. ๐ ูุฎุทุทุงุช ุชุฏูู ุงูุนูููุงุช (Process Workflows)

#### 2.1 ุชุฏูู ุงูุชุญูู ูู ุงุชุฌุงู ุงููุต (Direction Control Workflow)
ูุตู ูุฐุง ุงูุชุฏูู ูุง ูุญุฏุซ ุนูุฏูุง ูุบูุฑ ุงููุณุชุฎุฏู ูุถุน ุงูุงุชุฌุงู (Auto/RTL/LTR).

**ุงูููุทู ุงูุชุดุบููู:**
1.  **ุงููุญูุฒ (Trigger):** ุงููุณุชุฎุฏู ูุถุบุท ุฒุฑ "Direction Toggle" ุฃู ุงูุงุฎุชุตุงุฑ `Alt + Shift + D`.
2.  **ุงููุธุงู (Update State):**
    *   ูููู `Zustand` ุจุชุญุฏูุซ ูููุฉ `directionMode`.
    *   ูุชู ุญูุธ ุงููููุฉ ุงูุฌุฏูุฏุฉ ูู `localStorage`.
3.  **ุงููุญุฑุฑ (CodeMirror Reaction):**
    *   ูุณุชูุจู ุงูู `Compartment` ุงูุชุญุฏูุซ.
    *   **ุฅุฐุง ูุงู ุงููุถุน ุงูุฌุฏูุฏ (Forced RTL/LTR):**
        *   ูุชู ุฅุฒุงูุฉ `AutoRTLPlugin` (ูุฅููุงู ุงููุญุต).
        *   ูุชู ุชุทุจูู ุณูุฉ `dir="rtl/ltr"` ุนูู ุญุงููุฉ ุงููุญุฑุฑ.
    *   **ุฅุฐุง ูุงู ุงููุถุน ุงูุฌุฏูุฏ (Auto):**
        *   ูุชู ุชูุนูู `AutoRTLPlugin`.
        *   ูููู ุงููุญุฑุฑ ููุฑุงู ุจุฅุนุงุฏุฉ ูุญุต ุงูุฃุณุทุฑ ุงููุฑุฆูุฉ (Re-scan Visible Lines) ูุชูููููุง.
4.  **ุงููุชูุฌุฉ ุงููุฑุฆูุฉ:** ูุชุบูุฑ ูุญุงุฐุงุฉ ุงููุต ููุฑุงู ุฏูู ูููุถ ุฃู ุฅุนุงุฏุฉ ุชุญููู ููุตูุญุฉ.

#### 2.2 ุชุฏูู ุญู ุงูุตูุฑ ุงููุญููุฉ (Local Image Resolution Workflow)
ูุตู ููู ูุญูู ุงููุธุงู ูุต ูุงุฑู ุฏุงูู `![img](./pic.png)` ุฅูู ุตูุฑุฉ ูุฑุฆูุฉ.

**ุงูุฑุณู ุงูุชูุถูุญู ููุชุฏูู:**
```mermaid
sequenceDiagram
    participant User
    participant MarkdownRenderer
    participant FileSystemHook
    participant BrowserMemory

    User->>MarkdownRenderer: Writes ![img](./assets/logo.png)
    MarkdownRenderer->>MarkdownRenderer: Parse "src" attribute
    
    alt Is Relative Path?
        MarkdownRenderer->>FileSystemHook: Request FileHandle for "./assets/logo.png"
        FileSystemHook->>FileSystemHook: Search in File Tree
        
        alt File Found
            FileSystemHook->>BrowserMemory: Read File -> Create Blob
            BrowserMemory-->>MarkdownRenderer: Return "blob:http://localhost/..."
            MarkdownRenderer->>User: Display Image
        else File Not Found
            MarkdownRenderer->>User: Display Broken Image Icon
        end
    else Is Absolute URL (https://...)
        MarkdownRenderer->>User: Display Image Directly
    end
```

#### 2.3 ุชุฏูู ุฅุฏุงุฑุฉ ุงููููุงุช (CRUD Workflow)
1.  **ุฅูุดุงุก ููู ุฌุฏูุฏ:**
    *   ุงููุณุชุฎุฏู ูููุฑ ุฃููููุฉ "+".
    *   ุฅุฏุฎุงู ุงูุงุณู -> ุงููุธุงู ูุชุญูู ูู ุนุฏู ุงูุชูุฑุงุฑ.
    *   ุงููุธุงู ูุณุชุฏุนู `getFileHandle(create: true)`.
    *   ุชุญุฏูุซ ุงูุดุฌุฑุฉ ููุชุญ ุงูููู ุงูุฌุฏูุฏ ููุฑุงู.
2.  **ุญุฐู ููู:**
    *   ุงูููุฑ ุนูู "Delete".
    *   **ุดุฑุท:** ุฅุธูุงุฑ ูุงูุฐุฉ ุชุฃููุฏ (Dialog: "Are you sure?").
    *   ุนูุฏ ุงูููุงููุฉ -> ุงุณุชุฏุนุงุก `removeEntry` ูุชุญุฏูุซ ุงููุงุฌูุฉ.

---

### 3. ๐ค ุชูุงุตูู ุญุงูุงุช ุงูุงุณุชุฎุฏุงู (Detailed Use Cases)

#### **[UC-01] ุงูุชุญูู ูู ุงุชุฌุงู ุงููุต (Text Direction Control)**
*   **ุงููุตู:** ุชูููู ุงููุณุชุฎุฏู ูู ูุฑุถ ุงุชุฌุงู ูุนูู ูููุต ุฃู ุชุฑูู ุชููุงุฆูุงู.
*   **ุงููุงุนู:** ุงููุทูุฑ / ุงููุงุชุจ.
*   **ุงููุณุงุฑ ุงูุฃุณุงุณู (Switching Modes):**
    1.  ุงููุณุชุฎุฏู ููุชุจ ููุฏุงู ุฅูุฌููุฒูุงู ูู ูุถุน `Auto`.
    2.  ููุฑุฑ ูุชุงุจุฉ ุชุนููู ุทููู ุจุงูุนุฑุจูุฉุ ููู ุงูุฑููุฒ ุชุธูุฑ ุจุดูู ุบูุฑ ูุฑุชุจ.
    3.  ูุถุบุท `Alt + Shift + D` ููุชุจุฏูู ุฅูู `Forced RTL`.
    4.  **ุงููุธุงู:** ูุฌุจุฑ ูู ุงูููุฑุงุช (ุจูุง ูููุง ุงูููุฏ) ูููููู.
    5.  ูููู ุงููุณุชุฎุฏู ุงููุชุงุจุฉ ุจุงุฑุชูุงุญ.
    6.  ูุถุบุท `Alt + Shift + D` ูุฑุชูู ููุนูุฏุฉ ูู `Auto` ูุฑุคูุฉ ุงูุชูุณูู ุงูููุงุฆู.

#### **[UC-02] ุนุฑุถ ุงูุตูุฑ ุงููุญููุฉ (Local Image Viewing)**
*   **ุงููุตู:** ุฅุฏุฑุงุฌ ูุนุฑุถ ุงูุตูุฑ ุงููุฎุฒูุฉ ูู ููุณ ูุฌูุฏ ุงููุดุฑูุน.
*   **ุงูุดุฑูุท ุงููุณุจูุฉ:** ุงููุณุชุฎุฏู ูุชุญ ูุฌูุฏุงู ูุญุชูู ุนูู ุตูุฑ.
*   **ุงูุณููุงุฑูู:**
    1.  ุงููุณุชุฎุฏู ููุชุจ: `![Mypic](./images/screen.png)`.
    2.  **ุงููุธุงู (ูู ุงูุฎูููุฉ):** ูุญูู ุงููุณุงุฑุ ูุจุญุซ ุนู ุงููููุ ููุดุฆ `Blob URL`.
    3.  **ุงููุนุงููุฉ:** ุชุธูุฑ ุงูุตูุฑุฉ ููุฑุงู.
    4.  ุงููุณุชุฎุฏู ูุบูุฑ ุงุณู ุงูุตูุฑุฉ ูู ุงูู Sidebar.
    5.  **ุงููุธุงู:** ุงูุตูุฑุฉ ูู ุงููุนุงููุฉ "ุชุชูุณุฑ" (Broken Link).
    6.  ุงููุณุชุฎุฏู ูุนุฏู ุงูุฑุงุจุท ูู ุงููุญุฑุฑ ููุงุณู ุงูุฌุฏูุฏ -> ุชุธูุฑ ุงูุตูุฑุฉ ูุฌุฏุฏุงู.

#### **[UC-03] ุงูุญูุงูุฉ ูู ููุฏุงู ุงูุจูุงูุงุช (Dirty State Protection)**
*   **ุงููุตู:** ููุน ุงููุณุชุฎุฏู ูู ุฅุบูุงู ุงูุนูู ุบูุฑ ุงููุญููุธ.
*   **ุงูุณููุงุฑูู:**
    1.  ุงููุณุชุฎุฏู ูุนุฏู ูููุงู (ุชุธูุฑ ุนูุงูุฉ `*`).
    2.  ูุญุงูู ุฅุบูุงู ุชุจููุจ ุงููุชุตูุญ (Tab Close).
    3.  **ุงููุธุงู:** ูุนุชุฑุถ ุงูุญุฏุซ (`beforeunload`).
    4.  ุงููุชุตูุญ ูุธูุฑ ุฑุณุงูุฉ ูุธุงููุฉ: "Changes you made may not be saved."
    5.  ุงููุณุชุฎุฏู ูุถุบุท "Cancel".
    6.  ูุนูุฏ ุงููุณุชุฎุฏู ููุถุบุท `Ctrl+S`.
    7.  ุชุฎุชูู ุนูุงูุฉ `*`.
    8.  ูุบูู ุงููุชุตูุญ ุจุฃูุงู.

---

### 4. โ๏ธ ูุตูููุฉ ุงูุฃุฎุทุงุก ูุงูุงุณุชุฌุงุจุฉ (Error Response Matrix)

| ุฑูุฒ ุงูุฎุทุฃ | ุงูุญุงูุฉ (Condition) | ุงุณุชุฌุงุจุฉ ุงููุธุงู (System Behavior) | ุฑุณุงูุฉ ุงููุณุชุฎุฏู (User Feedback) |
| :--- | :--- | :--- | :--- |
| **ERR-IMG-01** | ุตูุฑุฉ ุบูุฑ ููุฌูุฏุฉ (404 Local) | ุนุฑุถ ุฃููููุฉ ุตูุฑุฉ ููุณูุฑุฉ ูู ุงููุนุงููุฉ. | (ูุง ุชูุฌุฏ ุฑุณุงูุฉ ููุจุซูุฉุ ููุท ุจุตุฑูุฉ) |
| **ERR-DIR-01** | ูุดู ุญูุธ ุงูุฅุนุฏุงุฏุงุช (Storage Full) | ุงูุงุณุชูุฑุงุฑ ุจุงูุนูู ุจุงููุถุน ุงูุงูุชุฑุงุถู. | "Could not save preferences." (Toast) |
| **ERR-PERM-01** | ููุฏุงู ุฅุฐู ุงููุชุงุจุฉ ุนูุฏ ุงูุญูุธ | ุฅุธูุงุฑ ูุงูุฐุฉ ุทูุจ ุงูุฅุฐู ููุฑุงู. | "Permission required to save changes." |

---

### 5. โจ๏ธ ุงุฎุชุตุงุฑุงุช ููุญุฉ ุงูููุงุชูุญ (Key Bindings)

ุชู ุชุญุฏูุซ ุงููุงุฆูุฉ ูุชุดูู ุงูุงุฎุชุตุงุฑุงุช ุงูุฌุฏูุฏุฉ.

| ุงูุงุฎุชุตุงุฑ (Shortcut) | ุงููุธููุฉ (Action) | ุงูุณูุงู (Context) |
| :--- | :--- | :--- |
| `Alt + Shift + D` | ุชุฏููุฑ ุงุชุฌุงู ุงููุต (Auto -> RTL -> LTR). | Global |
| `Ctrl + S` | ุญูุธ ุงูููู ุงูุญุงูู. | Global |
| `Ctrl + B` | ุฅุธูุงุฑ/ุฅุฎูุงุก ุงูุดุฑูุท ุงูุฌุงูุจู. | Global |
| `Ctrl + .` | (ุงุฎุชูุงุฑู) ุชูุนูู ูุถุน ุงูุชุฑููุฒ (Zen Mode). | Global |

---

### 6. ๐จ ุญุงูุงุช ูุงุฌูุฉ ุงููุณุชุฎุฏู (UI States)

#### 6.1 ุญุงูุฉ ุชุจุฏูู ุงูุงุชุฌุงู (Direction Toggle State)
*   **Auto:** ุงูุฃููููุฉ ุชุธูุฑ ุญุฑู (ยถ) ูุน ุณูููู ูุชุนุงูุณูู.
*   **RTL:** ุงูุฃููููุฉ ุชุธูุฑ ููุฑุฉ ูุญุงุฐูุฉ ูููููู (Highlight Active).
*   **LTR:** ุงูุฃููููุฉ ุชุธูุฑ ููุฑุฉ ูุญุงุฐูุฉ ูููุณุงุฑ.

#### 6.2 ุญุงูุฉ ุงูุตูุฑ (Image States)
*   **Loading:** (ูุงุฏุฑุฉ ูุญููุงู) ุชุธูุฑ ูููุถ ุฎููู (Skeleton) ููุงู ุงูุตูุฑุฉ.
*   **Success:** ุชุธูุฑ ุงูุตูุฑุฉ ุจุงูุฃุจุนุงุฏ ุงูุฃุตููุฉ (ุฃู `max-width: 100%`).
*   **Error:** ูุธูุฑ ูุฑุจุน ุฑูุงุฏู ูุน ุฃููููุฉ ุตูุฑุฉ ูุดุทูุจุฉ ูุงุณู ุงูููู (Alt Text).

```