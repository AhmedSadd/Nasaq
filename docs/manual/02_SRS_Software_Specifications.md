# ๐ Software Requirements Specification (SRS)
## Project: Nasaq (ูุณู)
**Version:** 1.1 (Total Control Implementation)
**Document ID:** 02_SRS
**Target Audience:** Frontend Developers, QA Engineers
**Date:** Jan 2026

---

### 1. ๐ ููุฏูุฉ (Introduction)

#### 1.1 ุงูุบุฑุถ (Purpose)
ุชุญุฏุฏ ูุฐู ุงููุซููุฉ ุงููุชุทูุจุงุช ุงูุจุฑูุฌูุฉ ุงูุชูุตูููุฉ ููุธุงู "Nasaq". ููู ุงููุฑุฌุน ุงูุฃุณุงุณู ูุจูุงุก ุงูููููุงุช (Components)ุ ูุฅุฏุงุฑุฉ ุงูุญุงูุฉ (State Management)ุ ูููุทู ุงูุชุนุงูู ูุน ุงููุชุตูุญ (Browser APIs).

#### 1.2 ุงููุทุงู (Scope)
ุงููุธุงู ูู ุชุทุจูู ุตูุญุฉ ูุงุญุฏุฉ (SPA) ูุนูู ููุญุฑุฑ ูุตูุต **Local-First**. ูุนุชูุฏ ูููุงู ุนูู ููุงุฑุฏ ุงูุนููู (Client-Side Resources) ููุง ูุชุตู ุจุฃู ุฎุงุฏู ุฎููู. ุงูููุฒุฉ ุงูุฃุณุงุณูุฉ ูู **ูุญุฑู ุงูุชูุฌูู ุงูุฏููุงูููู (Dynamic Direction Engine)** ุงูุฐู ูููุญ ุงููุณุชุฎุฏู ุชุญููุงู ูุงููุงู ูู ุงุชุฌุงู ุงููุต.

#### 1.3 ุงููุตุทูุญุงุช ูุงูุชุนุงุฑูู (Definitions & Acronyms)
*   **Compartment (CodeMirror):** ุขููุฉ ูู CodeMirror 6 ุชุณูุญ ุจุฅุนุงุฏุฉ ุถุจุท ุฌุฒุก ูุญุฏุฏ ูู ุฅุนุฏุงุฏุงุช ุงููุญุฑุฑ ุฏููุงููููุงู ุฏูู ุฅุนุงุฏุฉ ุจูุงุฆู ุจุงููุงูู.
*   **Blob URL:** ุฑุงุจุท ูุคูุช (`blob:...`) ูุดูุฑ ุฅูู ุจูุงูุงุช ูุฎุฒูุฉ ูู ุฐุงูุฑุฉ ุงููุชุตูุญุ ูุณุชุฎุฏู ูุนุฑุถ ุงูุตูุฑ ุงููุญููุฉ.
*   **AST (Abstract Syntax Tree):** ุดุฌุฑุฉ ุงูุชุฑููุจ ุงููุฌุฑุฏุฉุ ูุชุณุชุฎุฏู ููุง ูุชุญููู ุงููุงุฑู ุฏุงูู ูุงุณุชุจุฏุงู ุฑูุงุจุท ุงูุตูุฑ.
*   **Transient Update:** ุชุญุฏูุซ ุณุฑูุน ููุญุงูุฉ ูุง ูุณุจุจ ุฅุนุงุฏุฉ ุฑุณู (Re-render) ููููููุงุช ุงูุซูููุฉ (React Components).

---

### 2. ๐๏ธ ุงููุตู ุงูุนุงู (Overall Description)

#### 2.1 ููุธูุฑ ุงูููุชุฌ (Product Perspective)
*   **ุงููุงุฌูุฉ:** ูุจููุฉ ุจุงุณุชุฎุฏุงู React + Shadcn/UI.
*   **ุงููุญุฑู:** CodeMirror 6 ูุน ุฅุถุงูุงุช ูุฎุตุตุฉ (Custom Extensions).
*   **ุงูุชุฎุฒูู:** File System Access API (ุงูุฃุณุงุณู) ู IndexedDB (ุงูุงุญุชูุงุทู).

#### 2.2 ุฎุตุงุฆุต ุงููุณุชุฎุฏู (User Classes)
*   **ุงููุทูุฑ (Developer):** ูุญุชุงุฌ ููุชุงุจุฉ ููุฏ (LTR) ูุน ุดุฑูุญุงุช ุนุฑุจูุฉ (RTL). ูุณุชุฎุฏู ูุถุน `Auto`.
*   **ุงููุงุชุจ (Writer):** ููุชุจ ููุงูุงุช ุนุฑุจูุฉ ุจุญุชุฉ. ูุณุชุฎุฏู ูุถุน `Forced RTL`.

#### 2.3 ุจูุฆุฉ ุงูุชุดุบูู (Operating Environment)
*   **Primary:** Chrome/Edge (Desktop) - ุฏุนู ูุงูู ูููููุงุช.
*   **Fallback:** Firefox/Safari - ุฏุนู ุฌุฒุฆู (Upload/Download).

---

### 3. โ๏ธ ูุชุทูุจุงุช ุงููุธุงู ุงูุชูุตูููุฉ (Specific Requirements)

#### 3.1 ูุญุฏุฉ ุฅุฏุงุฑุฉ ุงููููุงุช (File System Module)

**[SRS-FILE-001] ูุชุญ ุงููุฌูุฏุงุช (Directory Access)**
*   **ุงููุฏุฎู:** ููุฑุฉ ุงููุณุชุฎุฏู ุนูู "Open Folder".
*   **ุงูุนูููุฉ:**
    1.  ุงุณุชุฏุนุงุก `window.showDirectoryPicker()`.
    2.  ุชุฎุฒูู ุงูู `rootHandle` ูู `Zustand Store`.
    3.  ุชูููุฐ ุฏุงูุฉ ุชูุฑุงุฑูุฉ (Recursive Function) ูุจูุงุก ุดุฌุฑุฉ ูุงุฆูุงุช `FileNode`:
        ```typescript
        type FileNode = { name: string, kind: 'file'|'dir', handle: FileSystemHandle, children?: FileNode[] }
        ```
*   **ุงูุงุณุชุซูุงุก:** ุฑูุถ ุงููุณุชุฎุฏู ููุฅุฐู ูููู ุงูุนูููุฉ ูุน ุฑุณุงูุฉ ุฎุทุฃ.

**[SRS-FILE-002] ุนูููุงุช ุฅุฏุงุฑุฉ ุงููููุงุช (CRUD Operations)**
*   **Create:** ุงุณุชุฎุฏุงู `dirHandle.getFileHandle(name, { create: true })`. ูุฌุจ ุชุญุฏูุซ ุดุฌุฑุฉ ุงููููุงุช ูู ุงููุงุฌูุฉ ููุฑูุงู.
*   **Read:** ูุฑุงุกุฉ ุงูููู ููุต (`getFile().text()`) ุนูุฏ ุงูููุฑ ุนููู.
*   **Update:** ุงููุชุงุจุฉ ุนุจุฑ `createWritable()` ุนูุฏ ุงูุญูุธ.
*   **Delete:** ุงุณุชุฎุฏุงู `dirHandle.removeEntry(name)` ูุน ุทูุจ ุชุฃููุฏ.

**[SRS-FILE-003] ูุนุงูุฌุฉ ุงูุตูุฑ ุงููุญููุฉ (Local Image Resolution)**
*   **ุงูุณููุงุฑูู:** ุงููุนุงููุฉ ุชุญุชูู ุนูู ุตูุฑุฉ ุจูุณุงุฑ ูุณุจู `![img](./assets/pic.png)`.
*   **ุงูููุทู:**
    1.  ุชุญููู ุงููุณุงุฑ ูุงุณุชุฎุฑุงุฌ ุงุณู ุงูููู ููููุนู.
    2.  ุงูุจุญุซ ูู ุดุฌุฑุฉ `FileNode` ุงูููุฌูุฏุฉ ูู ุงูุฐุงูุฑุฉ ุนู ุงูู Handle ุงููุทุงุจู.
    3.  ุงุณุชุฏุนุงุก `file.getFile()` ุซู `URL.createObjectURL(blob)`.
    4.  ุญูู ุงูุฑุงุจุท ุงููุคูุช (`blob:...`) ููุงู ุงููุณุงุฑ ุงููุณุจู ูู ุงูู Rendered HTML.

#### 3.2 ูุญุฏุฉ ุงููุญุฑุฑ ูุงูุชุญูู ูู ุงูุงุชุฌุงู (Editor Core & Direction Control)

**[SRS-EDIT-001] ูุนูุงุฑูุฉ ุงูุชุจุฏูู (Switching Architecture)**
*   ูุฌุจ ุงุณุชุฎุฏุงู `new Compartment()` ูู ุฅุนุฏุงุฏุงุช CodeMirror ูุชุบููู ุฅุถุงูุงุช ุงูุงุชุฌุงู.
*   ุนูุฏ ุชุบููุฑ `directionMode` ูู ุงูู Storeุ ูุชู ุชูููุฐ `view.dispatch` ูุชุญุฏูุซ ุงูู Compartment ููุท.

**[SRS-EDIT-002] ูุถุน ุงูุงุชุฌุงู ุงูุชููุงุฆู (Auto Mode Logic)**
*   **ุงูุชูุนูู:** ุนูุฏูุง `directionMode === 'auto'`.
*   **ุงูุขููุฉ:** ุชูุนูู `ViewPlugin` ูุฎุตุต.
*   **ุงูุฎูุงุฑุฒููุฉ:**
    *   ููู ุณุทุฑ ูุฑุฆู (Visible Range):
    *   ูุญุต ุงููุต ุจู Regex: `/^(\W*)[^\u0000-\u007F]/` (ุชุฌุงูู ุงูุฑููุฒ ุบูุฑ ุงููุตูุฉ ูู ุงูุจุฏุงูุฉ).
    *   ุฅุฐุง ุชุทุงุจู -> ุฅุถุงูุฉ CSS Class `cm-line-rtl`.
    *   ุบูุฑ ุฐูู -> ุฅุถุงูุฉ CSS Class `cm-line-ltr` (ุฃู ุชุฑู ุงูุงูุชุฑุงุถู).

**[SRS-EDIT-003] ุฃูุถุงุน ุงูุฅุฌุจุงุฑ (Forced RTL/LTR Modes)**
*   **ุงูุชูุนูู:** ุนูุฏูุง `directionMode === 'rtl'` ุฃู `'ltr'`.
*   **ุงูุขููุฉ:**
    1.  ุชุนุทูู ุงูู `ViewPlugin` ุงูุฎุงุต ุจุงูู Auto (ูุชูููุฑ ุงูุฃุฏุงุก).
    2.  ุชุทุจูู ุณูุฉ `dir="rtl"` ุฃู `dir="ltr"` ุนูู ุญุงููุฉ ุงููุญุฑุฑ ุงูุฌุฐุฑูุฉ (`.cm-editor`).
    3.  ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช `EditorView.theme` ูุถุจุท `&.cm-editor { direction: ... }`.

**[SRS-EDIT-004] ุชุจุฏูู ุงููุถุน (UI Toggle)**
*   ูุฌุจ ุชูููุฑ ุฒุฑ ุซูุงุซู ุงูุญุงูุงุช (Auto / RTL / LTR) ูู ุดุฑูุท ุงูุฃุฏูุงุช.
*   ุงูุงุฎุชุตุงุฑ `Alt + Shift + D` ูููู ุจุงูุชุฏููุฑ: `Auto` -> `RTL` -> `LTR` -> `Auto`.
*   ูุชู ุญูุธ ุงูุญุงูุฉ ุงููุฎุชุงุฑุฉ ูู `localStorage` ุชุญุช ููุชุงุญ `editor_direction_pref`.

#### 3.3 ูุญุฏุฉ ุงููุนุงููุฉ (Preview Module)

**[SRS-VIEW-001] ุฏุนู Mermaid**
*   ุฅูุดุงุก ูููู React ูุฑุงูุจ ูุชู ุงูููุฏ (`code`) ุฐุงุช ุงููุบุฉ `mermaid`.
*   ุงุณุชุฎุฏุงู `mermaid.render()` ูุชุญููู ุงููุต ุฅูู SVG ูุนุฑุถู.
*   ูุฌุจ ุงูุชุนุงูู ูุน ุฃุฎุทุงุก ุงูู Syntax (Parse Error) ุจุนุฑุถ ุฑุณุงูุฉ ูุตูุฉ ุฏุงุฎู ุงูุฅุทุงุฑ ุจุฏูุงู ูู ุชุญุทู ุงูุชุทุจูู.

**[SRS-VIEW-002] ุงูุชุฎุทูุท ุงููุงุจู ููุชุบููุฑ (Resizable Split Layout)**
*   ุงุณุชุฎุฏุงู ููุชุจุฉ `react-resizable-panels`.
*   **ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ:** [Editor: 50%, Preview: 50%].
*   **ุงูุงุชุฌุงู ุงูุงูุชุฑุงุถู:** ุงููุญุฑุฑ ูุณุงุฑ (Left)ุ ุงููุนุงููุฉ ูููู (Right).
*   ูุฌุจ ุญูุธ ููุถุน ุงููุงุตู (Position) ูู `localStorage`.

---

### 4. ๐ฅ๏ธ ูุชุทูุจุงุช ุงููุงุฌูุฉ ุงูุฎุงุฑุฌูุฉ (External Interface Requirements)

#### 4.1 ูุงุฌูุงุช ุงููุณุชุฎุฏู (User Interfaces)
*   **Theme:** ูุฌุจ ุงุณุชุฎุฏุงู ูุชุบูุฑุงุช CSS (CSS Variables) ููุฃููุงู ูุฏุนู ุงูุชุจุฏูู ุงูููุฑู ูููุถุน ุงููููู.
*   **Feedback:** ุงุณุชุฎุฏุงู "Toasts" ููุฅุดุนุงุฑุงุช ุงูุนุงุจุฑุฉ (ูุซู: "ุชู ุงูุญูุธ"ุ "ูุดู ูุชุญ ุงูุตูุฑุฉ").

#### 4.2 ูุงุฌูุงุช ุงูุจุฑูุฌูุงุช (Software Interfaces)
*   **IndexedDB:** ูุณุชุฎุฏู ุนุจุฑ ููุชุจุฉ `idb-keyval` ูุชุฎุฒูู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ (Backup) ููุคุดุฑุงุช ุงููููุงุช (ูู ุงููุชุตูุญุงุช ุงูุชู ุชุฏุนู ุงุณุชุนุงุฏุฉ ุงููุคุดุฑุงุช).

---

### 5. ๐ก๏ธ ุงููุชุทูุจุงุช ุบูุฑ ุงููุธูููุฉ (Non-Functional Requirements)

#### 5.1 ุงูุฃุฏุงุก (Performance)
*   **[NFR-01]** ุชุจุฏูู ูุถุน ุงูุงุชุฌุงู (ูุซูุงู ูู Auto ุฅูู RTL) ูุฌุจ ุฃู ูุชู ูู ุฃูู ูู **50ms** ุฏูู ุฅุนุงุฏุฉ ุชุญููู ุงููุญุฑุฑ.
*   **[NFR-02]** ุงูุชูุฑูุฑ (Scrolling) ุงููุชุฒุงูู ูุฌุจ ุฃู ูุญุงูุธ ุนูู ูุนุฏู 60fps.

#### 5.2 ุงูุฃูุงู (Security)
*   **[NFR-SEC-01]** ูุฌุจ ุชุนููู (Sanitize) ุฃู HTML ูุงุชุฌ ุนู ุงููุงุฑู ุฏุงูู ุจุงุณุชุฎุฏุงู `rehype-sanitize`.
*   **[NFR-SEC-02]** ูุฌุจ ุฃู ุชููู ุงูู Blob URLs ููุตูุฑ ุตุงูุญุฉ ููุท ูุฌูุณุฉ ุงูุนูู ุงูุญุงููุฉ ููุชู ุฅุจุทุงููุง (Revoke) ุนูุฏ ุฅุบูุงู ุงูููู ูุชุญุฑูุฑ ุงูุฐุงูุฑุฉ.

#### 5.3 ุงูููุซูููุฉ (Reliability)
*   **[NFR-REL-01]** ุญูุงูุฉ ุงูุจูุงูุงุช: ุนูุฏ ุงูุชุดุงู `isDirty === true`ุ ูุฌุจ ููุน ุฅุบูุงู ุงููุงูุฐุฉ ุนุจุฑ `beforeunload event`.

---

### 6. ๐พ ูุชุทูุจุงุช ุงูุจูุงูุงุช (Data Requirements)

#### 6.1 ูููุฐุฌ ุงูุญุงูุฉ (State Model)
ูููู `Zustand Store` ุงููุนุชูุฏ:
```typescript
interface AppState {
  settings: {
    theme: 'light' | 'dark';
    directionMode: 'auto' | 'rtl' | 'ltr'; // *New Requirement*
    splitRatio: number;
  };
  editor: {
    content: string;
    isDirty: boolean;
    filePath: string | null;
  };
  fileSystem: {
    rootHandle: FileSystemDirectoryHandle | null;
    tree: FileNode[];
  };
}
```